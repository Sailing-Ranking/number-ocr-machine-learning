schema: '2.0'
stages:
  train:
    cmd: pipenv run python src/02_train.py
    params:
      params.yaml:
        compile:
          metrics: accuracy
        model:
          filters: 32
          kernel_initializer: he_uniform
          input_shape:
          - 28
          - 28
          - 1
          activation: relu
          out_activation: softmax
          pooling:
          - 2
          - 2
          kernel_size:
          - 3
          - 3
          dropout: 0.5
        train:
          validation_split: 0.25
          epochs: 2
    outs:
    - path: data/experiment/cnn_classifier
      md5: f4ce00b8cc28c0c0fad1c23c02a12576.dir
      size: 1103956
      nfiles: 5
    - path: data/experiment/history.json
      md5: c9ede9e26ad98ccf3929a0f1b1d0da5d
      size: 218
  visualize:
    cmd: pipenv run python src/04_visualize.py
    deps:
    - path: data/experiment/history.json
      md5: c9ede9e26ad98ccf3929a0f1b1d0da5d
      size: 218
    - path: data/experiment/metrics.json
      md5: a51ff67353086d4bfc2cb1ae9df47a7a
      size: 114
    - path: data/experiment/predictions.csv
      md5: c569df9cefa446deae562c71e038a0f1
      size: 88905
    outs:
    - path: data/experiment/plots/acc_vs_val_acc.png
      md5: 1a743372077be91ab11080cbb87baa3e
      size: 43118
    - path: data/experiment/plots/confusion_matrix.png
      md5: 8a4736089049157bd6388b4a4def5cb2
      size: 84887
    - path: data/experiment/plots/loss_vs_val_loss.png
      md5: 89cb35d25d1ba26e77aaeb1fdc9133c2
      size: 35937
  evaluate:
    cmd: pipenv run python src/03_evaluate.py
    deps:
    - path: data/experiment/cnn_classifier
      md5: f4ce00b8cc28c0c0fad1c23c02a12576.dir
      size: 1103956
      nfiles: 5
    outs:
    - path: data/experiment/metrics.json
      md5: a51ff67353086d4bfc2cb1ae9df47a7a
      size: 114
    - path: data/experiment/predictions.csv
      md5: c569df9cefa446deae562c71e038a0f1
      size: 88905
  setup:
    cmd: pipenv run python src/01_setup.py
  test:
    cmd: pipenv run test src/05_test.py
    deps:
    - path: data/experiment/metrics.json
      md5: a51ff67353086d4bfc2cb1ae9df47a7a
      size: 114
